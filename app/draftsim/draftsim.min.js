(function(){"use strict";function t(t,i,r,u,f,e){function p(){i.getCardSetGroups().then(function(t){t[0][0].boostersToOpen=3;o.setGroups=t;trackEvent(n,"init")})}function h(n,t,i){var r=n.indexOf(i);r>-1&&n.splice(r,1);t.push(i)}function w(){t.activateController([p()],n).then(function(){o.landcards=u.getLandCards()})}function b(){for(var t,n=1;n<o.AIs.length;n++)o.AIs[n].processTurn();for(t=[],n=0;n<o.AIs.length;n++)t.push(o.AIs[n].boosterCards);for(o.AIs[0].boosterCards=t[o.AIs.length-1],o.boosterCards=o.AIs[0].boosterCards,n=1;n<o.AIs.length;n++)o.AIs[n].boosterCards=t[n-1]}function k(){var n,t;for(o.AIs=[],n=0;n<o.numberOfPlayers;n++)t=new e.AI(n),o.AIs.push(t);a()}function a(){var n=d(),u=n.boostersToOpen,t,r;for(n.boostersToOpen=1,t=0;t<o.numberOfPlayers;t++)r=i.openBoosterForCardSet(n),g(o.AIs[t],r);n.boostersToOpen=u-1}function d(){for(var i,t,r,n=0;n<o.fixedSetGroups.length;n++)for(i=o.fixedSetGroups[n],t=0;t<i.length;t++)if(r=i[t],r.boostersToOpen>0)return r}function g(n,t){return n.boosterCards.push.apply(n.boosterCards,t.mythicCards),n.boosterCards.push.apply(n.boosterCards,t.rareCards),n.boosterCards.push.apply(n.boosterCards,t.uncommonCards),n.boosterCards.push.apply(n.boosterCards,t.commonCards),n.boosterCards}var v=t.logger.getLogFn,s=v(n),y=t.logger.getLogFn(n,"success"),nt=t.logger.getLogFn(n,"error"),o=this,c,l;o.controllerId=n;o.title="Sealed Simulator";o.column1Title="Image";o.column2Title="Name";o.column3Title="Rarity";o.boosters_to_open=1;o.boosterCards=[];o.selectedCards=[];o.deckCards=[];o.draftFinished=!1;o.draftStarted=!1;o.packsOpened=0;o.totalPacksToOpen=3;o.landcards=[];o.selectedLandCards=[];o.cardsToGraph=[];c="Booster Cards";o.topPanelCardsTitle=c;l="Selected Cards Stats";o.cardStatsTitle=l;o.setGroups=[];o.fixedSetGroups=[];o.chartsHidden=!1;o.showCharts=function(){o.chartsHidden=!1};o.showExtraOptions=!1;o.displayExtraOptions=function(){o.showExtraOptions?(o.showExtraOptions=!1,trackEvent(n,"hide-extra-options")):(o.showExtraOptions=!0,trackEvent(n,"show-extra-options"))};o.downloadFullPool=function(){r.saveCardsList(o.selectedCards.concat(o.deckCards),"MyDraftPool");trackEvent(n,"download-full-pool")};o.downloadDraftDeck=function(){r.saveCardsList(o.deckCards.concat(o.selectedLandCards),"MyDeckSelection");trackEvent(n,"download-selected-pool")};o.addToDeck=function(t){h(o.boosterCards,o.selectedCards,t);y("You've chosen "+t.Name+"!");b();trackEvent(n,"card-picked",t.Name);o.boosterCards.length==0&&(o.packsOpened<o.totalPacksToOpen?o.openNextPack():(o.draftFinished=!0,o.topPanelCardsTitle="Deck Cards",trackEvent(n,"finished-draft"),o.cardsToGraph=o.selectedCards))};o.updateSelectedGraphCards=function(){o.cardsToGraph=o.deckCards.concat(o.selectedLandCards)};o.cardPoolClick=function(t){o.draftFinished&&(h(o.selectedCards,o.deckCards,t),o.cardStatsTitle="My Deck Stats",trackEvent(n,"removed-card-from-selection",t.Name),o.updateSelectedGraphCards())};o.deckCardClick=function(t){o.draftFinished&&(h(o.deckCards,o.selectedCards,t),trackEvent(n,"added-card-to-selection",t.Name),o.updateSelectedGraphCards())};o.landCardClick=function(t){o.draftFinished&&(o.selectedLandCards.push(t),trackEvent(n,"added-land-card",t.Name),o.updateSelectedGraphCards())};o.removeLandCard=function(t){var i=o.selectedLandCards.indexOf(t);i>-1&&(o.selectedLandCards.splice(i,1),trackEvent(n,"removed-land-card",t.Name),o.updateSelectedGraphCards())};o.removeFromDeck=function(n){h(o.selectedCards,o.boosterCards,n)};o.openBoosters=function(){return i.openSortedBoosters(o.boosters_to_open).then(function(n){return s("Opened "+o.boosters_to_open+" booster packs."),o.boosterCards.push.apply(o.boosterCards,n.mythicCards),o.boosterCards.push.apply(o.boosterCards,n.rareCards),o.boosterCards.push.apply(o.boosterCards,n.uncommonCards),o.boosterCards.push.apply(o.boosterCards,n.commonCards),o.boosterCards})};o.openNextPack=function(){s("Opening a new pack...");o.packsOpened++;a();o.boosterCards=o.AIs[0].boosterCards;s("Packs opened: "+o.packsOpened+" Total packs to open: "+o.totalPacksToOpen)};w();o.numberOfPlayers=8;o.AIs=[];o.startDraft=function(){var u,t,f,r;for(o.draftStarted=!0,o.draftFinished=!1,o.topPanelCardsTitle=c,o.cardStatsTitle=l,o.boosterCards=[],o.selectedCards=[],o.deckCards=[],o.selectedLandCards=[],o.cardsToGraph=o.selectedCards,o.fixedSetGroups=i.copyCardSetGroup(o.setGroups),u=0,t=0;t<o.fixedSetGroups.length;t++)for(f=o.fixedSetGroups[t],r=0;r<f.length;r++)u+=f[r].boostersToOpen;o.totalPacksToOpen=u;o.packsOpened=1;k();o.boosterCards=o.AIs[0].boosterCards;s("You've started a new draft");trackEvent(n,"start-draft")}}var n="draftsim";angular.module("app").controller(n,["common","datacontext","downloadDataService","landcards","$modal","ai",t])})();
//# sourceMappingURL=draftsim.min.js.map
