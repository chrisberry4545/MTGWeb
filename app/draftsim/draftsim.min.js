(function(){"use strict";function t(t,i,r,u,f,e,o,s){function b(){i.getCardSetGroups().then(function(t){t[0][0].boostersToOpen=3;h.setGroups=t;trackEvent(n,"init")})}function l(n,t,i){var r=n.indexOf(i);r>-1&&n.splice(r,1);t.push(i)}function k(){t.activateController([b()],n).then(function(){h.landcards=f.getLandCards();var n=200,t=200;u.setPieChartGraphElement("colorPieChartContainer",n,t);u.setBarChartGraphElement("manaCurveBarChartContainer",n,t);u.setTypeChartHolder("typePieChartContainer",n,t);u.resetAllCanvas()})}function d(){for(var t,n=1;n<h.AIs.length;n++)h.AIs[n].processTurn();for(t=[],n=0;n<h.AIs.length;n++)t.push(h.AIs[n].boosterCards);for(h.AIs[0].boosterCards=t[h.AIs.length-1],h.boosterCards=h.AIs[0].boosterCards,n=1;n<h.AIs.length;n++)h.AIs[n].boosterCards=t[n-1]}function g(){var n,t;for(h.AIs=[],n=0;n<h.numberOfPlayers;n++)t=new s.AI(n),h.AIs.push(t);y()}function y(){var n=nt(),u=n.boostersToOpen,t,r;for(n.boostersToOpen=1,t=0;t<h.numberOfPlayers;t++)r=i.openBoosterForCardSet(n),tt(h.AIs[t],r);n.boostersToOpen=u-1}function nt(){for(var i,t,r,n=0;n<h.fixedSetGroups.length;n++)for(i=h.fixedSetGroups[n],t=0;t<i.length;t++)if(r=i[t],r.boostersToOpen>0)return r}function tt(n,t){return n.boosterCards.push.apply(n.boosterCards,t.mythicCards),n.boosterCards.push.apply(n.boosterCards,t.rareCards),n.boosterCards.push.apply(n.boosterCards,t.uncommonCards),n.boosterCards.push.apply(n.boosterCards,t.commonCards),n.boosterCards}var p=t.logger.getLogFn,c=p(n),w=t.logger.getLogFn(n,"success"),it=t.logger.getLogFn(n,"error"),h=this,a,v;h.title="Sealed Simulator";h.column1Title="Image";h.column2Title="Name";h.column3Title="Rarity";h.boosters_to_open=1;h.boosterCards=[];h.selectedCards=[];h.deckCards=[];h.draftFinished=!1;h.draftStarted=!1;h.packsOpened=0;h.totalPacksToOpen=3;h.landcards=[];h.selectedLandCards=[];a="Booster Cards";h.topPanelCardsTitle=a;v="Selected Cards Stats";h.cardStatsTitle=v;h.setGroups=[];h.fixedSetGroups=[];h.chartsHidden=!1;h.hideCharts=function(){h.chartsHidden=!h.chartsHidden;trackEvent(n,"toggle-charts")};h.showExtraOptions=!1;h.displayExtraOptions=function(){h.showExtraOptions?(h.showExtraOptions=!1,trackEvent(n,"hide-extra-options")):(h.showExtraOptions=!0,trackEvent(n,"show-extra-options"))};h.downloadFullPool=function(){r.saveCardsList(h.selectedCards.concat(h.deckCards),"MyDraftPool");trackEvent(n,"download-full-pool")};h.downloadDraftDeck=function(){r.saveCardsList(h.deckCards.concat(h.selectedLandCards),"MyDeckSelection");trackEvent(n,"download-selected-pool")};h.addToDeck=function(t){l(h.boosterCards,h.selectedCards,t);w("You've chosen "+t.Name+"!");d();trackEvent(n,"card-picked",t.Name);h.boosterCards.length==0&&(h.packsOpened<h.totalPacksToOpen?h.openNextPack():(h.draftFinished=!0,h.topPanelCardsTitle="Deck Cards",trackEvent(n,"finished-draft")));u.displayChartsForCards(h.selectedCards)};h.cardPoolClick=function(t){h.draftFinished&&(l(h.selectedCards,h.deckCards,t),h.cardStatsTitle="My Deck Stats",u.displayChartsForCards(h.deckCards),trackEvent(n,"removed-card-from-selection",t.Name))};h.deckCardClick=function(t){h.draftFinished&&(l(h.deckCards,h.selectedCards,t),u.displayChartsForCards(h.deckCards),trackEvent(n,"added-card-to-selection",t.Name))};h.landCardClick=function(t){h.draftFinished&&(h.selectedLandCards.push(t),trackEvent(n,"added-land-card",t.Name))};h.removeLandCard=function(t){var i=h.selectedLandCards.indexOf(t);i>-1&&(h.selectedLandCards.splice(i,1),trackEvent(n,"removed-land-card",t.Name))};h.removeFromDeck=function(n){l(h.selectedCards,h.boosterCards,n)};h.openBoosters=function(){return i.openSortedBoosters(h.boosters_to_open).then(function(n){return c("Opened "+h.boosters_to_open+" booster packs."),h.boosterCards.push.apply(h.boosterCards,n.mythicCards),h.boosterCards.push.apply(h.boosterCards,n.rareCards),h.boosterCards.push.apply(h.boosterCards,n.uncommonCards),h.boosterCards.push.apply(h.boosterCards,n.commonCards),h.boosterCards})};h.openNextPack=function(){c("Opening a new pack...");h.packsOpened++;y();h.boosterCards=h.AIs[0].boosterCards;c("Packs opened: "+h.packsOpened+" Total packs to open: "+h.totalPacksToOpen)};k();h.numberOfPlayers=8;h.AIs=[];h.startDraft=function(){var f,t,e,r;for(h.draftStarted=!0,h.draftFinished=!1,h.topPanelCardsTitle=a,h.cardStatsTitle=v,u.resetAllCanvas(),h.boosterCards=[],h.selectedCards=[],h.deckCards=[],h.selectedLandCards=[],h.fixedSetGroups=i.copyCardSetGroup(h.setGroups),f=0,t=0;t<h.fixedSetGroups.length;t++)for(e=h.fixedSetGroups[t],r=0;r<e.length;r++)f+=e[r].boostersToOpen;h.totalPacksToOpen=f;h.packsOpened=1;g();h.boosterCards=h.AIs[0].boosterCards;c("You've started a new draft");trackEvent(n,"start-draft")};h.openHandSimulator=function(){var t=h.deckCards.concat(h.selectedLandCards),i;t.length>0?i=e.open({templateUrl:"handmodal.html",controller:"handmodal",resolve:{fullDeck:function(){return t}}}):c("Please add some cards to your deck (click on them below).");trackEvent(n,"opened-hand-simulator")}}var n="draftsim";angular.module("app").controller(n,["common","datacontext","downloadDataService","graphAnalysis","landcards","$modal","webapicontext","ai",t])})();
//# sourceMappingURL=draftsim.min.js.map
