(function(){"use strict";function t(t,i,r){function e(){u.gameState=u.notJoinedGameState;u.gameData=null;t.$apply()}function s(){setTimeout(s,u.pingTime);u.gameState==u.joinedGameState||u.gameState==u.createdGameState?u.refreshGameInfo():u.gameState==u.gameStartedState?u.startDraft():u.getGamesList()}function h(n){var t="";$.each(n,function(n,i){t+=c(i.PlayerName,i.Message)});u.chatbox=t}function c(n,t){return n+": "+t+"\n"}function a(){$.when(r.getFinalGameResults()).then(function(n){u.gameData=n;u.gameState=u.postGameState;t.$apply()})}function v(){u.getGamesList();var r=i.getAllSet3CardsNoDelay().splice(0),f=i.getAllSet1CardsNoDelay().splice(0),e=i.getAllSet2CardsNoDelay().splice(0);u.allCards=$.merge(e,f);u.allCards=$.merge(u.allCards,r);t.activateController([y()],n).then(function(){s();u.loading=!1})}function y(){$.when(r.getPlayerID()).then(function(n){n!=null&&(p(n),t.$apply())})}function p(n){switch(n.GameState){case u.notJoinedGameState:break;case u.joinedGameState:u.gameData=n;u.gameState=u.joinedGameState;break;case u.createdGameState:u.gameData=n;u.gameState=u.createdGameState;break;case u.gameStartedState:u.gameData=n;u.gameState=u.gameStartedState;break;case u.postGameState:u.gameData=n;u.gameState=u.postGameState;break;default:f("No appropriate game data found.")}}var l=t.logger.getLogFn,f=l(n),o=t.logger.getLogFn(n,"success"),u=this;u.title="Multiplayer Draft";u.tabNumber=0;u.pingTime=2500;u.playersInGame=[];u.gameData;u.allCards=[];u.boosters_to_open=[1,1,1];u.name=null;u.unsetName="";u.timeRemaining=0;u.disableChat=!1;u.joinedGameState=0;u.gameStartedState=1;u.postGameState=2;u.notJoinedGameState=3;u.createdGameState=4;u.gameState=u.notJoinedGameState;u.loading=!0;u.spinnerOptions={radius:40,lines:7,length:0,width:30,speed:1.7,corners:1,trail:100,color:"#C0C0C0"};u.chatMessage="";u.chatbox="";u.createGame=function(){o("Creating game..");u.name==null&&(u.name="");u.gameState!=u.createdGameState&&(u.loading=!0,$.when(r.createGame(u.name)).then(function(n){n!=null&&(u.gameState=u.createdGameState,u.gameData=n,u.loading=!1,t.$apply())}))};u.joinGame=function(n){o("Joining game..");u.loading=!0;$.when(r.joinGame(n,u.name)).then(function(n){n!=null?(u.gameState=u.joinedGameState,u.gameData=n,u.loading=!1,t.$apply()):f("This game has already started. Please try another.")})};u.leaveGame=function(){u.loading=!0;$.when(r.leaveGame()).then(function(){u.loading=!1;e()})};u.refreshGameInfo=function(){u.loading=!0;$.when(r.getGameInfo()).then(function(n){n!=null?(u.gameData=n,u.gameData.GameState==u.gameStartedState&&u.startDraft(),n.Chat!=null&&h(n.Chat),u.gameData.PlayerName!=null&&(u.name=u.gameData.PlayerName),u.loading=!1,t.$apply()):(u.gameState==u.gameStartedState?f("You've been inactive for too long and have been removed from the game."):f("You've been removed from the game."),e())})};u.getGamesList=function(){u.loading=!0;$.when(r.getListOfGames()).then(function(n){u.avaliableGames=n.Games;n.Chat!=null&&h(n.Chat);u.loading=!1;t.$apply()})};u.postMessage=function(){if(u.name==null||u.name=="")f("Please enter a name before posting a message.");else{var n=u.chatMessage;u.chatMessage="";u.chatbox+=c(u.name,n);r.postMessage(n,u.name)}};u.addCard=function(n){u.gameData.Player.HadTurn?f("You've already chosen a card this round."):(f("Card picked.."),u.loading=!0,$.when(r.addCard(n)).then(function(n){n!=null&&(u.gameData=n,u.gameData.GameState==u.postGameState&&a());u.loading=!1;t.$apply()}))};u.backToLobby=function(){e()};u.startDraft=function(){var n=0;$.each(u.boosters_to_open,function(t,i){n+=parseInt(i,10)});n!=3?f("You need 3 total boosters to start a game."):(u.gameState!=u.gameStartedState&&(o("Starting draft.."),u.loading=!0),$.when(r.startGame(u.boosters_to_open)).then(function(n){n!=null?(n.RoundTime-2>0&&(u.timeRemaining=n.RoundTime-2),u.gameState=u.gameStartedState,u.gameData=n,u.loading=!1,t.$apply()):(f("You've been inactive for too long and have been removed from the game."),e())}))};v();u.removePlayer=function(n){f("Attempting to remove player..");u.loading=!0;$.when(r.removePlayer(n)).then(function(){f("Player successfully removed.");u.loading=!1})};u.setName=function(){u.unsetName!=""?(u.name=u.unsetName,f("Name set to: "+u.name)):f("Please enter a name.")}}var n="multiplayerdraft";angular.module("app").controller(n,["common","datacontext","webapicontext",t])})();
/*
//# sourceMappingURL=multiplayerdraft.min.js.map
*/